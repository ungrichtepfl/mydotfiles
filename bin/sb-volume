#!/bin/sh
# Display volume levels (pactl-only).

. sb-theme

if ! command -v pactl >/dev/null 2>&1; then
    # pactl not available, nothing to display
    exit 1
fi

SINK="@DEFAULT_SINK@"

case "$BLOCK_BUTTON" in
    1) sensible-terminal.sh -e pulsemixer ;;
    2) pactl set-sink-mute "$SINK" toggle ;;
    4) pactl set-sink-volume "$SINK" +3% ;;
    5) pactl set-sink-volume "$SINK" -3% ;;
    6) sensible-terminal.sh -e "$EDITOR" "$0" ;;
esac

# Mute detection
if pactl get-sink-mute "$SINK" 2>/dev/null | grep -qi "yes"; then
    # Use a Nerd Font glyph for mute so it renders with FontAwesomeNerdFont
    display " " $warning
    exit
fi

# Extract highest channel percentage from sink volume output
volume=$(pactl get-sink-volume "$SINK" 2>/dev/null | grep -o '[0-9]\+%' | tr -d '%' | sort -nr | head -n1)

if [ -z "$volume" ]; then
    exit 1
fi

if [ "$volume" -gt 40 ]; then
    icon=" "
elif [ "$volume" -gt 15 ]; then
    icon=" "
else
    icon=" "
fi

display "$icon $volume%"
