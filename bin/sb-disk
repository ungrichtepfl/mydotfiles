#!/bin/sh
# Display disk usage for both `/` and `/home`.

. sb-theme

du="du"
if command -v dua >/dev/null 2>&1; then
    du="dua i"
elif command -v ncdu >/dev/null 2>&1; then
    du="ncdu"
fi

case $BLOCK_BUTTON in
    1)   
        if [ "$du" = "du" ]; then
            notify-send "Disk Space Home" "$(du -sh $HOME)"
        else
            sensible-terminal.sh -e $du "$HOME" 
        fi
        ;;
    6) sensible-terminal.sh -e "$EDITOR" "$0" ;;
esac

path="/"
icon="ó°‹Š"

# Get used, total (in KB) and percent from df -- avoid process substitution for /bin/sh
set -- $(df --output=used,size,pcent "$path" | tail -n1 | awk '{print $1, $2, $3}')
used_k=$1
total_k=$2
pcent=$3
# calculate GB integer values (round)
used_gib=$(awk "BEGIN {printf \"%d\", ($used_k/1000/1000)+0.5}")
total_gib=$(awk "BEGIN {printf \"%d\", ($total_k/1000/1000)+0.5}")

percent_used=$(echo "$pcent" | tr -d '%')
# color thresholds: warn >=80 (yellow), alert >=90 (red)
if [ "$percent_used" -ge 90 ]; then
    color=$critical
elif [ "$percent_used" -ge 80 ]; then
    color=$warning
else
    color=""
fi

# match i3status-rust format: icon, percentage (width 2) and (used / total) in GB
display "$icon   $(printf "%2s" "$percent_used")% ($used_gib GB / $total_gib GB)" "$color"
